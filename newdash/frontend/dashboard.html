<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPFBL Dashboard - Painel Administrativo</title>
    <link rel="stylesheet" href="dashboard.css?v=notify-fix">
    <script src="version.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Sistema de Notifica√ß√µes -->
    <div id="notification-container" class="notification-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 10000;"></div>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-toggle" onclick="toggleSidebar()" title="Compactar/Expandir">
                ‚óÄ
            </div>
            <div class="logo">
                <img src="/logo.png" alt="Logo SPFBL" style="max-width:200px;max-height:50px;width:auto;height:auto;">
            </div>
            <nav class="nav">
                <a href="#dashboard" class="nav-item active" onclick="showSection('dashboard', event)" data-label="Dashboard">
                    <span class="icon">üìä</span>
                    Dashboard
                </a>
                <a href="#queries" class="nav-item" onclick="showSection('queries', event)" data-label="Consultas">
                    <span class="icon">üìß</span>
                    Consultas
                </a>
                <a href="#servers" class="nav-item" onclick="showSection('servers', event)" data-label="Servidores">
                    <span class="icon">üñ•Ô∏è</span>
                    Servidores
                </a>
                <a href="#users" class="nav-item" onclick="showSection('users', event)" data-label="Usu√°rios">
                    <span class="icon">üë•</span>
                    Usu√°rios
                </a>
                <a href="#lists" class="nav-item" onclick="showSection('lists', event)" data-label="Listas (Block/White)">
                    <span class="icon">üìã</span>
                    Listas (Block/White)
                </a>
                <a href="/settings" class="nav-item" data-label="Configura√ß√µes">
                    <span class="icon">‚öôÔ∏è</span>
                    Configura√ß√µes
                </a>
                <a href="#logs" class="nav-item" onclick="showSection('logs', event)" data-label="Logs">
                    <span class="icon">üìú</span>
                    Logs
                </a>
                <a href="#subdomain-campaign" class="nav-item" onclick="showSection('subdomain-campaign', event)" data-label="Campanhas de Spam">
                    <span class="icon">üéØ</span>
                    Campanhas de Spam
                </a>
            </nav>
            <div class="sidebar-footer">
                <p class="dashboard-version" data-dashboard-version>v0.00</p>
                <p class="uptime" id="uptime">Carregando...</p>
                <p class="powered-by"><a href="https://github.com/leonamp/SPFBL" target="_blank" title="Powered by SPFBL">Powered by SPFBL</a></p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h2 id="page-title">Dashboard</h2>
                <div class="header-actions">
                    <span class="last-update">√öltima atualiza√ß√£o: <span id="last-update">--:--</span></span>
                    <button id="smtp-toggle" class="icon-btn" onclick="toggleSmtpNotifications()" title="Ativar/Desativar envio de e-mails do SPFBL">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="5" width="18" height="14" rx="2" ry="2"></rect>
                            <polyline points="3 7 12 13 21 7"></polyline>
                        </svg>
                    </button>
                    <button class="icon-btn" onclick="refreshData()" title="Atualizar dados">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <polyline points="1 20 1 14 7 14"></polyline>
                            <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"></path>
                        </svg>
                    </button>
                    <button id="theme-toggle" class="icon-btn" onclick="toggleTheme()" title="Alternar tema">
                        <span id="theme-toggle-icon" class="icon-embed" aria-hidden="true"></span>
                    </button>
                </div>
            </header>

            <!-- Dashboard Section (Main Stats) -->
            <section id="section-dashboard" class="content-section active">
                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-card large">
                        <h3>An√°lise Detalhada - √öltimas 24 Horas</h3>
                        <canvas id="detailed-stats-chart"></canvas>
                    </div>
                    <div class="chart-card large">
                        <h3>Bloqueios Diretos do Servidor - √öltimas 24 Horas</h3>
                        <canvas id="spam-hourly-chart"></canvas>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìß</div>
                        <div class="stat-info">
                            <h3>Consultas Hoje</h3>
                            <p class="stat-value" id="total-queries">--</p>
                            <span class="stat-trend">--</span>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <h3>Aprovados (PASS)</h3>
                            <p class="stat-value" id="passed-queries">--</p>
                            <span class="stat-percentage" id="passed-percent">--%</span>
                        </div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-icon">‚õî</div>
                        <div class="stat-info">
                            <h3>Bloqueados</h3>
                            <p class="stat-value" id="blocked-queries">--</p>
                            <span class="stat-percentage" id="blocked-percent">--%</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üñ•Ô∏è</div>
                        <div class="stat-info">
                            <h3>Clientes Ativos</h3>
                            <p class="stat-value" id="active-clients">--</p>
                            <span class="stat-trend">conectados</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üíæ</div>
                        <div class="stat-info">
                            <h3>Mem√≥ria do Servidor</h3>
                            <p class="stat-value" id="memory-percent">--</p>
                            <span class="stat-trend" id="memory-used">--</span>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">üîí</div>
                        <div class="stat-info">
                            <h3>Bloqueios Diretos</h3>
                            <p class="stat-value" id="spam-total-direct">0</p>
                            <div style="font-size: 12px; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(0,0,0,0.1);">
                                <div style="display: flex; justify-content: space-between; margin: 4px 0;">
                                    <span>Host:</span>
                                    <strong id="spam-host-direct">0</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 4px 0;">
                                    <span>Dom√≠nio:</span>
                                    <strong id="spam-domain-direct">0</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin: 4px 0;">
                                    <span>IP:</span>
                                    <strong id="spam-ip-direct">0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Queries Section -->
            <section id="section-queries" class="content-section">
                <div class="queries-filters">
                    <input type="text" id="search-queries" placeholder="Buscar por IP, remetente ou destinat√°rio..." class="search-input">
                    <select id="filter-result" class="filter-select">
                        <option value="">Todos os resultados</option>
                        <option value="PASS">PASS</option>
                        <option value="BLOCKED">BLOCKED</option>
                        <option value="SOFTFAIL">SOFTFAIL</option>
                        <option value="FAIL">FAIL</option>
                        <option value="--- SPAM Blocks ---" disabled>--- SPAM Blocks ---</option>
                        <option value="SPAM_HOST_BLOCKED">üö´ Host Bloqueado (SPAM)</option>
                        <option value="SPAM_DOMAIN_BLOCKED">üö´ Dom√≠nio Bloqueado (SPAM)</option>
                        <option value="SPAM_IP_BLOCKED">üö´ IP Bloqueado (SPAM)</option>
                    </select>
                </div>
                <div class="queries-toolbar">
                    <div class="selected-query-panel" id="selected-query-panel">
                        <div class="selected-query-info" id="selected-query-info">
                            <span class="placeholder">Nenhuma consulta selecionada</span>
                        </div>
                        <div class="selected-query-buttons">
                            <div class="selected-button-group">
                                <button
                                    id="action-clear-selection"
                                    class="btn btn-ghost btn-compact"
                                    type="button"
                                    onclick="clearSelectedQuery()"
                                    disabled
                                >
                                    Limpar sele√ß√£o
                                </button>
                                <button
                                    id="action-block-ip"
                                    class="btn btn-danger btn-compact"
                                    type="button"
                                    onclick="handleSelectedAction('block-ip')"
                                    disabled
                                >
                                    Bloquear IP
                                </button>
                                <button
                                    id="action-whitelist-ip"
                                    class="btn btn-success btn-compact"
                                    type="button"
                                    onclick="handleSelectedAction('whitelist-ip')"
                                    disabled
                                >
                                    Whitelist
                                </button>
                                <button
                                    id="action-block-sender"
                                    class="btn btn-outline btn-compact"
                                    type="button"
                                    onclick="handleSelectedAction('block-sender')"
                                    disabled
                                >
                                    Bloquear remetente
                                </button>
                            </div>
                            <div class="selected-button-group global">
                                <button
                                    class="btn btn-success btn-compact"
                                    type="button"
                                    onclick="handleUnblockToken()"
                                    title="Desbloquear IP/Dom√≠nio/Email"
                                >
                                    üîì Desbloquear
                                </button>
                                <button
                                    class="btn btn-danger btn-compact"
                                    type="button"
                                    onclick="handleRemoveFromWhitelist()"
                                    title="Remover da Whitelist"
                                >
                                    ‚ùå Remover da Whitelist
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table" id="queries-table">
                        <thead>
                            <tr>
                                <th>Hor√°rio</th>
                                <th>Resultado</th>
                                <th>IP Origem</th>
                                <th>Remetente</th>
                                <th>Destinat√°rio</th>
                                <th>HELO</th>
                            </tr>
                        </thead>
                        <tbody id="queries-tbody">
                            <tr><td colspan="6" class="loading">Carregando consultas...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Servers Section -->
            <section id="section-servers" class="content-section">
                <div class="section-header">
                    <h2>Servidores Conectados</h2>
                    <button class="btn btn-primary btn-add-client" onclick="openAddServerModal()">
                        + Adicionar Servidor
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="select-column">Selecionar</th>
                                <th>Hostname</th>
                                <th>IP/CIDR</th>
                                <th>Tipo</th>
                                <th>Status</th>
                                <th>Informa√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="servers-tbody">
                            <tr><td colspan="6" class="loading">Carregando servidores...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="servers-actions">
                    <button
                        id="btn-remove-servers"
                        class="btn btn-danger btn-remove-servers"
                        type="button"
                        onclick="handleRemoveServers()"
                        disabled
                    >
                        Remover Servidor
                    </button>
                </div>
            </section>

            <!-- Users Section -->
            <section id="section-users" class="content-section">
                <div class="section-header">
                    <h2>Usu√°rios do Sistema</h2>
                    <button class="btn btn-primary btn-add-client" onclick="openAddUserModal()">
                        + Adicionar Usu√°rio
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="select-column"></th>
                                <th>Email</th>
                                <th>Nome</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <tr><td colspan="5" class="loading">Carregando usu√°rios...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>


            <!-- Lists Section (Block & White) -->
            <section id="section-lists" class="content-section">
                <!-- Formul√°rios de Adi√ß√£o Manual -->
                <div class="add-forms-container">
                    <div class="add-form-card">
                        <div class="add-form-header">
                            <span class="add-form-icon">üö´</span>
                            <h3>Bloquear Manualmente</h3>
                        </div>
                        <div class="add-form-body">
                            <input
                                type="text"
                                id="blocklist-add-input"
                                class="add-form-input"
                                placeholder="Digite IP, dom√≠nio ou email para bloquear"
                                autocomplete="off"
                                onkeypress="if(event.key==='Enter') addToBlocklist()"
                            />
	                            <button class="btn btn-danger btn-compact" type="button" onclick="addToBlocklist()">
	                                üö´ Bloquear
	                            </button>
                        </div>
                    </div>

                    <div class="add-form-card">
                        <div class="add-form-header">
                            <span class="add-form-icon">‚úÖ</span>
                            <h3>Adicionar √† Whitelist</h3>
                        </div>
                        <div class="add-form-body">
                            <input
                                type="text"
                                id="whitelist-add-input"
                                class="add-form-input"
                                placeholder="Digite IP, dom√≠nio ou email"
                                autocomplete="off"
                                onkeypress="if(event.key==='Enter') addToWhitelist()"
                            />
	                            <button class="btn btn-success btn-compact" type="button" onclick="addToWhitelist()">
	                                ‚ûï Adicionar
	                            </button>
                        </div>
                    </div>
                </div>

                <!-- Blacklist -->
                <div class="list-container">
                    <div class="list-header">
                        <div>
                            <h3>üö´ Blacklist (Bloqueados)</h3>
                            <span class="list-count" id="blocklist-count">0 itens</span>
                        </div>
                        <div class="list-toolbar">
	                            <label class="inline-row">
	                                <input type="checkbox" id="blocklist-select-all" onchange="toggleSelectAll('block')" />
	                                Selecionar todos
	                            </label>
	                            <div class="list-filter" id="blocklist-filter" role="group" aria-label="Filtrar blacklist">
	                                <button type="button" class="btn btn-ghost btn-compact filter-pill active" data-type="all" aria-pressed="true">Todos</button>
	                                <button type="button" class="btn btn-ghost btn-compact filter-pill" data-type="ip" aria-pressed="false">IPs</button>
	                                <button type="button" class="btn btn-ghost btn-compact filter-pill" data-type="domain" aria-pressed="false">Dom√≠nios</button>
	                                <button type="button" class="btn btn-ghost btn-compact filter-pill" data-type="pair" aria-pressed="false">Campanhas</button>
	                                <button type="button" class="btn btn-ghost btn-compact filter-pill" data-type="email" aria-pressed="false">Emails</button>
	                            </div>
	                            <div class="list-search">
	                                <input type="text" id="blocklist-search" class="list-search-input" placeholder="Buscar IP, dom√≠nio, email ou campanha" autocomplete="off" />
	                                <button class="btn btn-ghost btn-compact list-search-clear" type="button" id="blocklist-search-clear" onclick="clearBlocklistSearch()" disabled>Limpar</button>
	                            </div>
		                            <div class="btn-group">
		                                <button class="btn btn-primary btn-compact" type="button" onclick="bulkUnblock()">üîì Desbloquear</button>
		                                <button class="btn btn-primary btn-compact" type="button" onclick="bulkUnblockAndWhitelist()">‚úÖ Desbloquear + Whitelist</button>
	                                <button class="btn btn-green btn-compact" type="button" onclick="bulkWhitelist()">‚úÖ Adicionar √† Whitelist</button>
		                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
	                                <tr>
	                                    <th style="width:32px;">#</th>
	                                    <th>Token (IP/Dom√≠nio/Email/Campanha)</th>
	                                    <th>Tipo</th>
	                                    <th style="width:180px;">Data/Hora</th>
	                                </tr>
                            </thead>
                            <tbody id="blocklist-tbody">
                                <tr><td colspan="4" class="loading">Carregando blacklist...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="list-footer">
                        <div class="list-pagination">
                            <button class="btn btn-ghost btn-compact list-page-btn" type="button" id="blocklist-page-prev" onclick="changeListPage('blocklist', -1)" disabled>‚óÄ Anterior</button>
                            <span class="page-info" id="blocklist-page-info">P√°gina 1/1</span>
                            <button class="btn btn-ghost btn-compact list-page-btn" type="button" id="blocklist-page-next" onclick="changeListPage('blocklist', 1)" disabled>Pr√≥xima ‚ñ∂</button>
                        </div>
                        <div class="list-status" id="blocklist-status"></div>
                    </div>
                </div>

                <!-- Whitelist -->
                <div class="list-container">
                    <div class="list-header">
                        <div>
                            <h3>‚úÖ Whitelist (Permitidos)</h3>
                            <span class="list-count" id="whitelist-count">0 itens</span>
                        </div>
                        <div class="list-toolbar">
                            <label class="inline-row">
                                <input type="checkbox" id="whitelist-select-all" onchange="toggleSelectAll('white')" />
                                Selecionar todos
                            </label>
	                            <div class="btn-group">
	                                <button class="btn btn-danger btn-compact" type="button" onclick="bulkRemoveWhitelist()">üóëÔ∏è Remover da Whitelist</button>
	                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width:32px;">#</th>
                                    <th>Token (IP/Dom√≠nio/Email)</th>
                                    <th>Tipo</th>
                                </tr>
                            </thead>
                            <tbody id="whitelist-tbody">
                                <tr><td colspan="3" class="loading">Carregando whitelist...</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="list-footer">
                        <div class="list-pagination">
                            <button class="btn btn-ghost btn-compact list-page-btn" type="button" id="whitelist-page-prev" onclick="changeListPage('whitelist', -1)" disabled>‚óÄ Anterior</button>
                            <span class="page-info" id="whitelist-page-info">P√°gina 1/1</span>
                            <button class="btn btn-ghost btn-compact list-page-btn" type="button" id="whitelist-page-next" onclick="changeListPage('whitelist', 1)" disabled>Pr√≥xima ‚ñ∂</button>
                        </div>
                        <div class="list-status" id="whitelist-status"></div>
                    </div>
                </div>
            </section>

            <!-- Logs Section -->
            <section id="section-logs" class="content-section">
                <div class="section-header">
                    <h2>Logs do SPFBL</h2>
                    <button class="btn btn-primary btn-refresh" type="button" onclick="refreshLogs()">
                        üîÑ Atualizar
                    </button>
                </div>

                <div class="logs-grid">
                    <div class="logs-card">
                        <div class="logs-meta">
                            <h3>Atividade de E-mails</h3>
                            <div class="logs-meta-row">
                                <span id="logs-email-file-label" class="logs-file">Arquivo: -</span>
                            </div>
                            <span class="logs-hint">Consultas, bloqueios, resultados SPFBL e SMTP</span>
                        </div>
                        <div class="logs-container">
                            <pre id="logs-email-content" class="logs-content"><span class="loading">Carregando logs de e-mail...</span></pre>
                        </div>
                    </div>

                    <div class="logs-card">
                        <div class="logs-meta">
                            <h3>Atividade de Usu√°rios/Admin</h3>
                            <div class="logs-meta-row">
                                <span id="logs-users-file-label" class="logs-file">Arquivo: -</span>
                            </div>
                            <span class="logs-hint">Cria√ß√£o de usu√°rios, TOTP, comandos ADMIN</span>
                        </div>
                        <div class="logs-container">
                            <pre id="logs-users-content" class="logs-content"><span class="loading">Carregando logs de usu√°rios...</span></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Subdomain Campaign Blocker Section -->
            <section id="section-subdomain-campaign" class="content-section">
                <div class="addon-header">
                    <div class="addon-header-info">
                        <h3>üéØ Bloqueador de Campanhas de Spam por Subdom√≠nios</h3>
                        <p class="muted">Detecta e bloqueia automaticamente campanhas de spam que usam m√∫ltiplos subdom√≠nios do mesmo dom√≠nio base com padr√µes num√©ricos.</p>
                        <div class="addon-pill-row">
                            <span class="addon-pill">Detec√ß√£o de Padr√µes</span>
                            <span class="addon-pill">Multi-Crit√©rio</span>
                            <span class="addon-pill">Wildcard Blocking</span>
                        </div>
                    </div>
                    <div class="addon-header-actions">
                        <button class="btn btn-primary btn-compact" type="button" onclick="saveSubdomainCampaignConfig()">üíæ Salvar configura√ß√£o</button>
                        <button id="subdomain-campaign-scan-button" class="btn btn-primary btn-compact" type="button" onclick="runSubdomainCampaignScan(true)">‚ñ∂Ô∏è Executar an√°lise</button>
                    </div>
                </div>

                <!-- Status Card -->
                <div class="addon-card addon-status-card-full">
                    <div class="addon-card-header">
                        <span class="addon-card-title">üìä Status do Sistema</span>
                    </div>
                    <p id="subdomain-campaign-status" class="addon-status-text">Carregando configura√ß√£o...</p>
                </div>

                <!-- Abas de Navega√ß√£o -->
                <div class="addon-tabs">
                    <button class="addon-tab-btn active" onclick="switchSubdomainCampaignTab('report', event)">üìä Campanhas Detectadas</button>
                    <button class="addon-tab-btn" onclick="switchSubdomainCampaignTab('autoblock', event)">üö® Bloqueio Autom√°tico</button>
                    <button class="addon-tab-btn" onclick="switchSubdomainCampaignTab('config', event)">‚öôÔ∏è Configura√ß√£o</button>
                </div>

                <!-- Aba: Campanhas Detectadas -->
                <div id="subdomain-campaign-tab-report" class="addon-tab-content active">
                    <div class="addon-tab-grid">
                        <div class="addon-card addon-card-full">
                            <div class="addon-card-header">
                                <span class="addon-card-title">üéØ Campanhas de Alto Risco</span>
                                <button class="btn btn-ghost btn-sm" type="button" onclick="toggleSubdomainCampaignDetails()">
                                    <span id="subdomain-campaign-toggle-icon">‚ñº</span> Detalhes
                                </button>
                            </div>
                            <div id="subdomain-campaign-summary" class="addon-summary"></div>
                            <div id="subdomain-campaign-details" class="addon-report-details" style="display: none;">
                                <div class="addon-card-header" style="margin-top: 1rem;">
                                    <span class="addon-card-title">üîç Detalhamento Completo das Campanhas</span>
                                </div>
                                <textarea id="subdomain-campaign-results" class="addon-results-textarea" readonly rows="15" placeholder="Execute uma an√°lise para ver as campanhas detectadas..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba: Bloqueio Autom√°tico -->
                <div id="subdomain-campaign-tab-autoblock" class="addon-tab-content">
                    <div class="addon-tab-grid">
                        <!-- Card 1: Automa√ß√£o Principal -->
                        <div class="addon-card addon-card-full">
                            <div class="addon-card-header">
                                <span class="addon-card-title">ü§ñ Configura√ß√£o de Automa√ß√£o</span>
                            </div>
                            <div class="addon-form-stack">
                                <label class="inline-row checkbox-large">
                                    <input type="checkbox" id="subdomain-campaign-enabled" />
                                    <span><strong>Habilitar Detector de Campanhas</strong></span>
                                </label>
                                <p class="section-help">üîç Ativa a varredura cont√≠nua em busca de campanhas de spam por subdom√≠nios.</p>

                                <label class="inline-row checkbox-large">
                                    <input type="checkbox" id="subdomain-campaign-auto-block" />
                                    <span><strong>Ativar Bloqueio Autom√°tico</strong></span>
                                </label>
                                <p class="section-help">‚ö° Quando ativado, bloqueia automaticamente dom√≠nios base (wildcard) de campanhas detectadas.</p>

                                <label class="inline-row">
                                    <input type="checkbox" id="subdomain-campaign-dry-run" />
                                    <span><strong>Modo Simula√ß√£o (Dry Run)</strong></span>
                                </label>
                                <p class="section-help">üß™ Apenas simula bloqueios sem execut√°-los. Recomendado para testes iniciais.</p>
                            </div>
                        </div>

                        <!-- Card 2: Risk Scoring -->
                        <div class="addon-card addon-card-full">
                            <div class="addon-card-header">
                                <span class="addon-card-title">üéØ Sistema de Pontua√ß√£o de Risco</span>
                            </div>
                            <div class="addon-form-stack">
                                <div class="addon-slider-block">
                                    <div class="addon-slider-header">
                                        <label for="subdomain-campaign-risk-threshold">Limiar de Bloqueio (Risk Score 0-100)</label>
                                        <span id="subdomain-campaign-risk-threshold-value" class="addon-slider-value">70</span>
                                    </div>
                                    <input type="range" id="subdomain-campaign-risk-threshold" min="30" max="100" step="5" value="70" class="slider">
                                    <div class="addon-slider-meta">
                                        <span>Mais Agressivo</span>
                                        <span>Mais Conservador</span>
                                    </div>
                                    <p class="section-help">üí° <strong>Recomendado: 70</strong> (balanceado) ‚Ä¢ 80 (conservador) ‚Ä¢ 60 (agressivo)</p>
                                </div>
                                <div class="addon-info-box">
                                    <strong>üßÆ Crit√©rios de Pontua√ß√£o:</strong>
                                    <ul style="margin: 0.5rem 0 0 1.2rem; font-size: 0.9em;">
                                        <li><strong>Padr√£o Num√©rico</strong> (0-35 pts) - Subdom√≠nios com n√∫meros (ex: doc123)</li>
                                        <li><strong>Quantidade de Subdom√≠nios</strong> (0-25 pts) - M√∫ltiplos subdom√≠nios</li>
                                        <li><strong>Taxa PASS</strong> (0-20 pts) - Spam passando SPF</li>
                                        <li><strong>Velocidade</strong> (0-15 pts) - Eventos por hora</li>
                                        <li><strong>Botnet</strong> (0-10 pts) - M√∫ltiplos IPs diferentes</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Card 3: A√ß√£o de Bloqueio -->
                        <div class="addon-card addon-card-full">
                            <div class="addon-card-header">
                                <span class="addon-card-title">üõ°Ô∏è Tipo de Bloqueio</span>
                            </div>
                            <div class="addon-form-stack">
                                <label class="inline-row">
                                    <input type="radio" name="block-action" id="subdomain-campaign-block-action-block" value="block" />
                                    <span><strong>Block</strong> - Bloqueia dom√≠nio com wildcard (.dominio.com)</span>
                                </label>
                                <label class="inline-row">
                                    <input type="radio" name="block-action" id="subdomain-campaign-block-action-superblock" value="superblock" checked />
                                    <span><strong>Superblock</strong> - Bloqueio mais restritivo (recomendado)</span>
                                </label>
                                <p class="section-help">‚ö†Ô∏è Superblock √© mais agressivo e bloqueia de forma mais abrangente. Use para campanhas persistentes.</p>
                            </div>
                        </div>

                        <!-- Card 4: Log de A√ß√µes -->
                        <div class="addon-card addon-card-full">
                            <div class="addon-card-header">
                                <span class="addon-card-title">üìã Hist√≥rico de Bloqueios</span>
                            </div>
                            <textarea id="subdomain-campaign-actions" class="addon-actions-log-textarea" readonly rows="10" placeholder="Nenhuma a√ß√£o executada ainda. Os bloqueios aparecer√£o aqui..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Aba: Configura√ß√£o -->
                <div id="subdomain-campaign-tab-config" class="addon-tab-content">
                    <div class="addon-tab-grid">
                        <!-- Card 1: Par√¢metros de Detec√ß√£o -->
                        <div class="addon-card addon-card-full">
                            <div class="addon-card-header">
                                <span class="addon-card-title">üîç Par√¢metros de Detec√ß√£o</span>
                            </div>
                            <div class="addon-form-grid">
                                <div class="addon-form-field">
                                    <label for="subdomain-campaign-window">üìÖ Janela de An√°lise (horas)</label>
                                    <input type="number" id="subdomain-campaign-window" min="1" max="72" class="search-input" value="6">
                                    <small class="field-hint">Padr√£o: 6h (detec√ß√£o r√°pida de ataques)</small>
                                </div>
                                <div class="addon-form-field">
                                    <label for="subdomain-campaign-min-subdomains">üéØ M√≠nimo de Subdom√≠nios</label>
                                    <input type="number" id="subdomain-campaign-min-subdomains" min="2" max="20" class="search-input" value="3">
                                    <small class="field-hint">M√≠nimo de subdom√≠nios para considerar campanha</small>
                                </div>
                                <div class="addon-form-field">
                                    <label for="subdomain-campaign-min-events">üî¢ M√≠nimo de Eventos</label>
                                    <input type="number" id="subdomain-campaign-min-events" min="5" max="1000" class="search-input" value="10">
                                    <small class="field-hint">Eventos m√≠nimos por dom√≠nio base</small>
                                </div>
                                <div class="addon-form-field">
                                    <label for="subdomain-campaign-poll">‚è±Ô∏è Intervalo de Scan (segundos)</label>
                                    <input type="number" id="subdomain-campaign-poll" min="30" max="3600" class="search-input" value="60">
                                    <small class="field-hint">Frequ√™ncia da varredura autom√°tica</small>
                                </div>
                            </div>
                        </div>

                        <!-- Card 2: Whitelist -->
                        <div class="addon-card addon-card-full">
                            <div class="addon-card-header">
                                <span class="addon-card-title">üõ°Ô∏è Whitelist (Dom√≠nios Protegidos)</span>
                            </div>
                            <div class="addon-form-stack">
                                <label for="subdomain-campaign-whitelist">Dom√≠nios que nunca ser√£o bloqueados</label>
                                <textarea id="subdomain-campaign-whitelist" class="search-input" rows="4" placeholder="Ex.: cliente-importante.com&#10;parceiro.com.br&#10;dominio-confiavel.net&#10;(um por linha ou separado por v√≠rgula)"></textarea>
                                <p class="section-help">üõ°Ô∏è Dom√≠nios listados aqui ser√£o ignorados pelo detector, mesmo que apresentem padr√µes suspeitos.</p>
                                <div class="addon-info-box">
                                    <strong>‚ÑπÔ∏è Whitelist Autom√°tica:</strong>
                                    <p style="margin: 0.3rem 0 0 0; font-size: 0.9em;">
                                        O sistema j√° ignora automaticamente servi√ßos conhecidos como sendgrid.net, amazonses.com, mailgun.org, hubspotemail.net, e outros.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Card 3: Exemplos de Detec√ß√£o -->
                        <div class="addon-card addon-card-full">
                            <div class="addon-card-header">
                                <span class="addon-card-title">üìö Exemplos de Campanhas Detectadas</span>
                            </div>
                            <div class="addon-info-box">
                                <strong>üéØ Padr√µes T√≠picos de Spam:</strong>
                                <div style="margin-top: 0.5rem; font-family: monospace; font-size: 0.85em;">
                                    <div style="margin-bottom: 0.5rem;">
                                        <strong>Campanha "pagarfacil":</strong><br>
                                        ‚Üí docfiscal160.pagarfacilbrasil.com<br>
                                        ‚Üí docfiscal183.pagarfacilgo.com<br>
                                        ‚Üí docfiscal137.pagarfacilaqui.com
                                    </div>
                                    <div>
                                        <strong>Campanha "frutagostosa":</strong><br>
                                        ‚Üí relatorios05e.acaisolteirofrutagostosa.sbs<br>
                                        ‚Üí relatorios10j.abiufrutagostosa.sbs<br>
                                        ‚Üí relatorios13m.acaifrutagostosa.sbs
                                    </div>
                                </div>
                                <p style="margin: 0.8rem 0 0 0; font-size: 0.9em;">
                                    ‚úÖ <strong>Caracter√≠sticas comuns:</strong> Prefixo comum + n√∫mero + dom√≠nio base vari√°vel
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal Adicionar Servidor -->
    <div id="addServerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Adicionar Novo Servidor</h2>
                <span class="close" onclick="closeAddServerModal()">&times;</span>
            </div>
            <form id="addServerForm" onsubmit="handleAddServer(event)">
                <div class="form-group">
                    <label for="client-ip">Endere√ßo IP ou CIDR *</label>
                    <input
                        type="text"
                        id="client-ip"
                        name="ip"
                        required
                        placeholder="192.168.1.100 ou 192.168.1.0/24"
                        pattern="^(\d{1,3}\.){3}\d{1,3}(\/\d{1,2})?$"
                        title="Formato: x.x.x.x ou x.x.x.x/xx"
                    >
                    <small>Exemplo: 192.168.1.100 ou 192.168.1.0/24</small>
                </div>

                <div class="form-group">
                    <label for="client-domain">Dom√≠nio *</label>
                    <input
                        type="text"
                        id="client-domain"
                        name="domain"
                        required
                        placeholder="example.com"
                        pattern="^[a-zA-Z0-9][a-zA-Z0-9-_.]+[a-zA-Z0-9]$"
                        title="Formato v√°lido de dom√≠nio"
                    >
                    <small>Exemplo: mail.example.com</small>
                </div>

                <div class="form-group">
                    <label for="client-option">Tipo de Consulta *</label>
                    <select id="client-option" name="option" required>
                        <option value="SPFBL" selected>SPFBL (Recomendado)</option>
                        <option value="DNSBL">DNSBL</option>
                        <option value="NONE">NONE</option>
                    </select>
                    <small>SPFBL: Verifica√ß√£o completa SPF, DKIM, DMARC</small>
                </div>

                <div class="form-group">
                    <label for="client-email">Email do Administrador</label>
                    <input
                        type="email"
                        id="client-email"
                        name="email"
                        placeholder="admin@example.com"
                    >
                    <small>Opcional: Email para notifica√ß√µes</small>
                </div>

                <div id="modal-error-message" class="error-message" style="display: none;"></div>
                <div id="modal-success-message" class="success-message" style="display: none;"></div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-ghost btn-cancel" onclick="closeAddServerModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary btn-submit" id="btn-submit-server">
                        Adicionar Servidor
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Adicionar Usu√°rio -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Adicionar Novo Usu√°rio</h2>
                <span class="close" onclick="closeAddUserModal()">&times;</span>
            </div>
            <form id="addUserForm" onsubmit="handleAddUser(event)">
                <div class="form-group">
                    <label for="user-email">Email do Usu√°rio *</label>
                    <input
                        type="email"
                        id="user-email"
                        name="email"
                        required
                        placeholder="usuario@domain.com"
                        pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                        title="Formato v√°lido de email"
                    >
                    <small>Este ser√° o login do usu√°rio no painel web</small>
                </div>

                <div class="form-group">
                    <label for="user-name">Nome Completo *</label>
                    <input
                        type="text"
                        id="user-name"
                        name="name"
                        required
                        placeholder="Jo√£o Silva"
                        minlength="3"
                        title="Nome completo do usu√°rio"
                    >
                    <small>Nome de identifica√ß√£o do usu√°rio</small>
                </div>

                <div id="user-modal-error-message" class="error-message" style="display: none;"></div>
                <div id="user-modal-success-message" class="success-message" style="display: none;"></div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-ghost btn-cancel" onclick="closeAddUserModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary btn-submit" id="btn-submit-user">
                        Adicionar Usu√°rio
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="dashboard.js"></script>
</body>
</html>
